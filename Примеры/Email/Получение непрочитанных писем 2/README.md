# Получение непрочитанных писем (пример №2)
В данном примере продемонстрирован вариант получения текстов сообщений и вложений с сохранением в контекст робота списка контекстов писем. Каждый элемент списка представляется в виде строки JSON. Кроме этого создан класс для удобства.

Логика следующая:

1. Загружаем необходимую информацию по письму.
2. По каждому письму создаем контекст, содержащий необходимый набор информации.
3. Добавляем контекст письма, представленный как строка в формате JSON, в список контекста робота.
4. В любом другом месте после этого мы можем из списка контекстов получить контекст по каждому письму.

В отличии от примера №1 данный вариант позволяет сохранять целостность информации по каждому письму, т.к. мы имеет только один список контекстов, в которых есть несколько необходимых полей.

Минус тут только в том, что нужно постоянно парсить строки контекстов. И если делам класс контекста для удобства, то его придется добавлять в каждый проект скриптов, в котором предполагается использование. Если не делать класс контекста, то все равно придется "таскать" везде фрагмент кода по парсингу строки JSON.

Структура проекта данного примера может вызвать сложности у некоторых. Попробую объяснить. В данном примере по сути представлены 2 скрипта. 1й будет получать данные, а 2й будет использовать эти данные.

Напоминаю, что сам скрипт по сути описан в классе ScriptActivity, который стандартно находится в файле ScriptActivity.cs. В файле Context.cs сгенерирован общий контекст робота, который используется самим роботом, а также во всех скриптах. Есть еще файл Program.cs, который не используется самим роботом, но позволяет инициализировать контекст робота какими-то тестовыми/отладочными данными и скрипт, запуская его выполнение. Также есть проектный файл, стандартно называется Script.csproj, но в примерах имеет другие названия. Обычно в одном проекте один скрипт вне робота.

Но в данном примере, чтобы не создавать 2 проекта и дублировать исходный код, в одном проекте сразу 2 скрипта. Второй скрипт в файле ScriptActivity2.cs. Кроме этого существует 2 дополнительных фалов: DevSettings.cs - контекст настроек для разработки и MessageContext.cs - контекст писем. DevSettings в данном примере нужен лишь для тестирования/отладки, чтобы было удобнее заполнять контекст робота из файла, а не хранить данные прямо в коде. MessageContext нужен для работы скриптов, поэтому его в реальности необходимо добавить во все проекты скриптов, где есть необходимость работать с контекстом писем.

Используется [MailKit](https://github.com/jstedfast/MailKit).